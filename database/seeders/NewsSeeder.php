<?php

namespace Database\Seeders;

use App\Models\News;
use App\Models\User;
use Illuminate\Database\Seeder;

class NewsSeeder extends Seeder
{
    public function run(): void
    {
        // Get the first admin user as author
        $author = User::whereHas('roles', function ($query) {
            $query->whereIn('name', ['super-admin', 'admin']);
        })->first();

        if (!$author) {
            $this->command->warn('No admin user found. Skipping news seeding.');
            return;
        }

        $newsArticles = [
            [
                'title' => 'Новые возможности нашей системы остекления',
                'content' => '<h2>Революционные изменения в остеклении</h2>
                <p>Мы рады представить вам последние обновления нашей системы остекления, которые существенно улучшают качество и функциональность наших продуктов.</p>
                
                <h3>Основные преимущества:</h3>
                <ul>
                    <li><strong>Улучшенная теплоизоляция</strong> - на 30% лучше предыдущих моделей</li>
                    <li><strong>Повышенная прочность</strong> - выдерживает нагрузки до 150 кг/м²</li>
                    <li><strong>Новые цветовые решения</strong> - более 50 вариантов расцветок</li>
                    <li><strong>Экологичность</strong> - 100% перерабатываемые материалы</li>
                </ul>

                <p>Эти инновации стали возможны благодаря многолетним исследованиям и разработкам нашей команды инженеров.</p>
                
                <blockquote>
                    "Мы стремимся создавать продукты, которые не только соответствуют современным требованиям, но и превосходят ожидания наших клиентов" - Главный инженер компании
                </blockquote>',
                'excerpt' => 'Представляем новые возможности нашей системы остекления с улучшенной теплоизоляцией и повышенной прочностью.',
                'status' => 'published',
                'published_at' => now()->subDays(5),
            ],
            [
                'title' => 'Открытие нового производственного цеха',
                'content' => '<h2>Расширение производственных мощностей</h2>
                <p>1 марта 2024 года состоялось торжественное открытие нового производственного цеха площадью 5000 м², оснащенного самым современным оборудованием.</p>
                
                <h3>Новые возможности производства:</h3>
                <table border="1">
                    <thead>
                        <tr>
                            <th>Параметр</th>
                            <th>Старый цех</th>
                            <th>Новый цех</th>
                            <th>Прирост</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Производительность</td>
                            <td>1000 ед/мес</td>
                            <td>2500 ед/мес</td>
                            <td>+150%</td>
                        </tr>
                        <tr>
                            <td>Качество изделий</td>
                            <td>98%</td>
                            <td>99.5%</td>
                            <td>+1.5%</td>
                        </tr>
                        <tr>
                            <td>Энергоэффективность</td>
                            <td>Стандарт</td>
                            <td>A+++</td>
                            <td>-40% потребления</td>
                        </tr>
                    </tbody>
                </table>
                
                <p>Инвестиции в модернизацию производства составили 50 миллионов рублей. Это позволит нам значительно сократить сроки изготовления заказов и повысить качество продукции.</p>',
                'excerpt' => 'Торжественное открытие нового производственного цеха увеличит наши возможности производства на 150%.',
                'status' => 'published',
                'published_at' => now()->subDays(10),
            ],
            [
                'title' => 'Сертификация по международным стандартам ISO',
                'content' => '<h2>Международное признание качества</h2>
                <p>Наша компания успешно прошла сертификацию по международным стандартам ISO 9001:2015 и ISO 14001:2015, что подтверждает высокое качество наших продуктов и процессов.</p>
                
                <h3>Что это означает для клиентов:</h3>
                <ul>
                    <li>Гарантия качества продукции на международном уровне</li>
                    <li>Соблюдение экологических стандартов</li>
                    <li>Постоянное улучшение производственных процессов</li>
                    <li>Возможность участия в международных тендерах</li>
                </ul>

                <p>Процесс сертификации занял 8 месяцев и включал детальный аудит всех аспектов нашей деятельности.</p>
                
                <h3>Планы на будущее</h3>
                <p>В ближайшие 6 месяцев мы планируем получить дополнительные сертификаты:</p>
                <ul>
                    <li>ISO 45001 (охрана труда и безопасность)</li>
                    <li>ISO 50001 (энергетический менеджмент)</li>
                </ul>',
                'excerpt' => 'Получены международные сертификаты ISO 9001:2015 и ISO 14001:2015, подтверждающие высокое качество нашей продукции.',
                'status' => 'published',
                'published_at' => now()->subDays(15),
            ],
            [
                'title' => 'Участие в выставке "СтройЭкспо 2024"',
                'content' => '<h2>Успешное участие в крупнейшей строительной выставке</h2>
                <p>С 15 по 18 февраля наша компания приняла участие в международной выставке "СтройЭкспо 2024" в Москве, где представила новейшие разработки в области остекления.</p>
                
                <h3>Основные достижения на выставке:</h3>
                <ul>
                    <li>Более 1000 посетителей стенда</li>
                    <li>50+ потенциальных партнеров</li>
                    <li>15 предварительных договоров</li>
                    <li>Награда "Лучший инновационный продукт"</li>
                </ul>

                <p>Особый интерес посетителей вызвала наша новая линейка энергосберегающих стеклопакетов с технологией Smart Glass.</p>',
                'excerpt' => 'Успешное участие в выставке СтройЭкспо 2024 принесло новых партнеров и награду за инновации.',
                'status' => 'published',
                'published_at' => now()->subDays(20),
            ],
            [
                'title' => 'Запуск программы лояльности для постоянных клиентов',
                'content' => '<h2>Новые преимущества для наших клиентов</h2>
                <p>Мы запускаем программу лояльности "Золотой партнер", которая предоставляет эксклюзивные условия для постоянных клиентов.</p>
                
                <h3>Уровни программы:</h3>
                <ul>
                    <li><strong>Бронза</strong> (от 500 тыс. руб. в год) - скидка 5%</li>
                    <li><strong>Серебро</strong> (от 1 млн. руб. в год) - скидка 8%</li>
                    <li><strong>Золото</strong> (от 3 млн. руб. в год) - скидка 12%</li>
                    <li><strong>Платина</strong> (от 5 млн. руб. в год) - скидка 15%</li>
                </ul>
                
                <p>Дополнительные преимущества включают приоритетное обслуживание, бесплатную доставку и персонального менеджера.</p>',
                'excerpt' => 'Запуск программы лояльности с эксклюзивными условиями и скидками до 15% для постоянных клиентов.',
                'status' => 'draft',
                'published_at' => null,
            ],
        ];

        foreach ($newsArticles as $article) {
            News::create([
                'title' => $article['title'],
                'content' => $article['content'],
                'excerpt' => $article['excerpt'],
                'status' => $article['status'],
                'published_at' => $article['published_at'],
                'author_id' => $author->id,
                'views' => rand(50, 500),
                'seo_title' => $article['title'] . ' | Ваша компания',
                'seo_description' => $article['excerpt'],
            ]);
        }

        $this->command->info('News articles seeded successfully!');
    }
} 